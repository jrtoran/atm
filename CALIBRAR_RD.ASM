;  RUTINA CALIBRAR PARAMETROS PRODUCCION PH REDOX Y CLORO LIBRE
; EN ESTA RUTINA ESTA EL CONTROL DE LA PANTALLA

PRO8:	; PARA AJUSTAR LA SAL DEL AGUA
	SBRS			CONTROL,6			; SALTA LA PROXIMA INSTRUCION SI ES UNO, TIENE SONDA DE REDOX
	JMP				PRO9				; VA A CALIBRACION DE CLORO
	CALL			CAL_TECLA			; PROGRAMA PANTALLA CALIBRACCION
	LDS				R30, RAMC_RD		; VALOR PARA EL CALIBRADO DEL REDOX
	LDI				R22, 00
	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
PRO8A:
	LDI				R22,00
	LDI				R18,32				; APAGA EL DIGITO SAL
	STS				$92D,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
	STS				$92E,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
	STS				$92F,R18
	CALL			CAL_TECLA
PRO8B:			; TIEMPO DIGITO APAGADO
	CPI				R22,RETARDO3		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
	BRLO			PRO8B				; COMPRUEBA EL TIEMPO DE RETARDO 
	CALL			LEDPANT
	WDR
	; VALOR DE MEDICION REDOX	
	LDI				R18,P_RD			; LINEA DE ENTRADA
	MOV				R26,R30				; NUMERO DE LECTURAS Ó CALIBRACION
	CALL			ADC_P
			
subi	r24, 46
	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
	CALL			RADC5I
	STS				$92D,R1
	STS				$92E,R2
	STS				$92F,R3
	CALL			CAL_TECLA
PRO8C:
	CPI				R22,RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
	BRLO			PRO8C				; COMPRUEBA EL TIEMPO DE RETARDO 

	; VALOR DE MEDICION 	
	WDR
	LDI				R22,00				; reatardo lectura de las valores 
	CALL			LEC_TEC
	CPI				R17, 0B11111101		; TECLA - BAJA EL VALOR
	BREQ			BAJAR_RD
	CPI				R17, 0B11101111		; TECLA + INCREMENTA EL VALOR
	BREQ			SUBIR_RD
	CPI				R17, 0B01111111		; TECLA 7 SALIR VA A CALIBRACION REDOX
	BREQ			SALIR_RD1
	CPI				R17, 0B11111011		; TECLA FLECHA GRAVA Y VA A CALIBRACION CLORO
	BREQ			SALIR_RD

	MOV				R24, TEMP_TEC
	CPI				R24, 50				; PARA COMPARARLO CON EL RETARDO SIN PULSAR TECLA
	BRPL			SALIR_RD1			; Y SALIR DE PROGRAMACION DE PARAMETROS
	RJMP			PRO8A
BAJAR_RD:
	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
	DEC				R30
	LDI				R22,00
	CPI				R30,200				; VALOR MINIMO DE REDOX
	BRBC			0, BAJAR_RD1 
	LDI				R30,200
	RJMP			PRO8A
BAJAR_RD1:
	RJMP			PRO8A
SUBIR_RD:
	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
	INC				R30
	LDI				R22,00
	CPI				R30,254				; REDOX MAXIMO
	BRBS			0, SUBIR_RD1		; SI MAYOR SALTA A SUBIR_PH1 Y PONE R31 CON EL VALOR MAZIMO
	LDI				R30,254
SUBIR_RD1:
	RJMP			PRO8A
SALIR_RD:  ; GRABA LOS NUEVOS VALORES Y VA A CALIBRAR CLORO
	STS				RAMC_RD, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
	LDI				R17, RDC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
	MOV				R18, R30 
	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
	CALL			NO_TECLA			; PARA ESPERAR A QUE SE SUELTE LA TECLA SALIR
	JMP				PRO9				; VA A CALIBRACION DE CLORO
	RET
SALIR_RD1:  ; GRABA LOS VALORES Y TERMINA
	STS				RAMC_RD, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
	LDI				R17, RDC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
	MOV				R18, R30 
	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
	MOV				R16, VAL_LED		;APAGA LUZ PANTALLA
	ANDI			R16, 0B10111111
	MOV				VAL_LED, R16
	CALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
	CALL			NO_TECLA
	RET

