
; PRESENTACION PRIMER ERROR EN PANTALLA " EN ESPERA 2 MIN."
; PARA SALTAR MAS
ERROR_2_C:
	CALL			ENCENDER_FUENTE
	CALL			LEDPANT
	RJMP			ERROR_2_D
ERROR_2:
;	CALL			APAGAR_FUENTE
	CALL			LEDPANT
;cargamos TEXTO PRESENTACION   PRESENTACION DE AVERIA
    LDI   			YH,0x02        	; direcion alta donde se pone el texto en RAM
    LDI   			YL,0x20      	; direccion baja donde se pone el texto en RAM 
    LDI   			ZH,high(TEXTO5*2); direccion alta del TEXTO en Flash
    LDI   			ZL,low(TEXTO5*2) ; direccion baja del TEXTO en Flash 
    LDI   			R16,32      	; longitud de texto a copiar en RAM TRES LINEAS
;*** RURINA CARGAR TEXTO DE FLASH A RAM  
;EN Y (YH,YL) POSICION EN RAM
;EN Z (ZH,ZL) POSICION EN FLASH
;EN R16 NUMERO DE LETRAS (BYTS)

CARGA_TEXTO2:
	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
	ADIW  			YL,1      		
	DEC   			R16      		; Hemos terminado..?? 
	BRNE  			CARGA_TEXTO2   	; NO...seguimos cargando 
	NOP     						; SI...terminamos 
	LDI				R19, 12			; TIEMPO DE ESPERA EN SEGUNDOS

ERROR_2_A:
	NOP
	SBRS			CONTROL_1, 0	; SALTA LA PROXIMA INSTRUCION SI ES UNO,
	RJMP			ERROR_2_A		; AJUSTE DE SEGUNDO
	CLT								; PONE A CERO EL BIT T DE SREG
	BLD				CONTROL_1, 0	; PASA EL REGISTRO T A CONTROL_1

	DEC				R19
	BRBS			1, ERROR_2_B	; SI LLEGA A CERO SALTA A ERROR_2_B SI NO NO
	CPI				R19, 5			; COMPARA LOS SEGUNDOS CON 4 SI ES MENOR ENCIENDE LA FUNETE
	BRBS			0, ERROR_2_C	; A LA LINEA 1 PARA SALTAR A ENCENDER FUENTE
ERROR_2_D:
; ESCRIBE LINEA 1 " EN ESPERA
	LDI				R16, 128		; 11000000 escribir en linea 1 linea (192)
	CALL			ENVINT
	LDI				YH,HIGH (PRUEBA_2)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL,LOW  (PRUEBA_2)	; direccion BAJA DEL TEXTO EN RAM      	
  	LDI				R17,16 			; bytes a enviar 
	CALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANRALLA

; ESCRIBE LINEA 2 "  SEGUNGOS
	MOV				R24, R19
	CALL			RADC
	STS				$232, R1
	STS				$233, R2
	STS				$234, R3
	LDI				R16, 192		; 11000000 escribir en linea 2 linea (192)
	CALL			ENVINT
	LDI				YH,HIGH (PRUEBA_3)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL,LOW  (PRUEBA_3)	; direccion BAJA DEL TEXTO EN RAM      	
  	LDI				R17,16 			; bytes a enviar 
	CALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANRALLA
	WDR
	RJMP			ERROR_2_A

ERROR_2_B:
; VUELVE A MEDIR LA SAL Y RETORNA
; VALOR DE MEDICION TOTAL	
	LDI				R18, 03				; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
	LDS				R26, RAMC_SAL		; NUMERO DE LECTURAS Ó CALIBRACION DE 50 A 180
	RCALL			PCF
;PRO3D: ;Grabar el valor en RAM Ó NO
	SBRC			VAL_LED, 1			; SALTA LA SIGUIENTE INSTRUCION SI ES CERO "VERANO"
	LSL				R24					; SI ES INVIERNO MULTIPLICA POR DOS
	MOV				R16, R24
CPI	R24, 4	; COMPARA CON 4 VALOR MINIMO DE SAL ERROR PERMANENTE
BRBS 0, ERROR_2_B1 ; SI ES MENOR SALTA A ERROR_2_B1
	RET		

ERROR_2_B1:
CALL APAGAR_FUENTE
JMP PRO2CA4	; RETORNA PARA MOSTRAR FALLO ELECTRODO
