; RUTINA AJUSTE_CL PARA LA SONDA ECL6 CLORO LIBRE VALOR POR DEFECTO 24

;TECLA_CL:
	MOV				R16,VAL_LED			; SECUENCIA PARA
	ORI				R16,0B01000000		; ENCENDER LA 
	MOV				VAL_LED,R16			; PANTALLA
	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
	LDS				R30,RAMC_CL			; CARGA EL VALOR LEIDO EN R30
	LDI				R16,00				; PONE EL RETARDO DEL TECLADO A 0
	MOV				R7,R16
	LDI				R22,00
TECLA_CLB:			; OPCION AUMENTAR VALOR
	WDR
	RCALL			TECLA_CLH			; PRESENTA LINEA DOS EN PANTALLA
	CALL			LEC_TEC				; LLAMA A LA RUTINA PARA LEER EL TECLADO
;	CPI				R17,0B00010000		; TECLA 2 INCREMENTA EL VALOR
	CPI				R17,0B11101111		; IDEM
	BRNE			TECLA_CLC			; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
	LDI				R16,00				; PONE EL RETARDO DEL TECLADO A 0
	MOV				R7,R16
	INC				R30					; INCREMENTA EL VALOR
	LDI				R22,00				; CARGA EL RETARDO DE LECTURA DEL TECLADO
TECLA_CLC:			; OPCION DISMINUIR 
;	CPI				R17,0B00000010		; TECLA 2 PARA DISMINUIR
	CPI				R17,0B11111101		; IDEM
	BRNE			TECLA_CLD			; SI NO ESTA PULSADA SALTA
	LDI				R16,000				; PONE EL RETARDO DEL TECLADO A 0
	MOV				R7,R16	
	DEC				R30					; DISMINUYE EL VALOR
	LDI				R22,00				; CARGA EL RETARDO DE LECTURA DEL TECLADO
TECLA_CLD:			; OPCION SALIR DE LECTURA DE TECLADO 
;	CPI				R17,0B10000000		; TECLA 7 
	CPI				R17,0B01111111		; IDEM
	BRNE			TECLA_CLE			; SI NO ES 80 SALTA A TECLA_CLE PARA SEGUIR AJUSTANDO EL VALOR
	RJMP			TECLA_CLF			; TERMINA Y SALE PARA GRABAR
TECLA_CLE:
	CPI				R22,vel_tec			; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
	BRLO			TECLA_CLE			; COMPRUEBA EL TIEMPO DE RETARDO 
	RJMP			TECLA_CLB
TECLA_CLF:
	STS				RAMC_CL,R30
	LDI				R17, CLC_MEN
	MOV				R18,R30				; GRABA EL VALOR 
;	RCALL			I2CE_2404			; LLAMA A LA RUTINA PARA ESCRIBIR EN EEPROM
	MOV				R16,VAL_LED			; SECUENCIA PARA
	ANDI			R16,0B10111111		; APAGAR LA
	MOV				VAL_LED,R16			; PANTALLA
	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
	RET
TECLA_CLH:
	LDI				R16, 32				; PARA GRABAR EL ESPACIO EN PANTALLA
	STS				$01E0,R16
	STS				$01E1,R16
	STS				$01E2,R16
	STS				$01E3,R16
	STS				$01E4,R16
	STS				$01E5,R16
	STS				$01E8,R16
	STS				$01EC,R16
	STS				$01ED,R16
	STS				$01EE,R16
	STS				$01EF,R16
	MOV				R24,R30				; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
	CALL			RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
	STS				$01E9,R1
	STS				$01EA,R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PH
	STS				$01EB,R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PH
	STS				$0240,R16	
	LDI				R16,67				; ESCRIBE UNA C
	STS				$01E6,R16
	LDI				R16,76				; ESCRIBE UNA L
	STS				$01E7,R16	
	LDI				R16,192				; 11000000 escribir en linea 2 linea (192)
	CALL			ENVINT
	LDI				YH,HIGH (LIN_2P)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL,LOW  (LIN_2P)	; direccion BAJA DEL TEXTO EN RAM      	
  	LDI				R17,16 				; bytes a enviar 
	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
	RET



