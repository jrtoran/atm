; RUTINA DE RETARDO EN R19 LOS SEGUNDOS

RUT_RETARDO:
	CALL			BORRAR_PANTALLA
	LDI				R24,1
	STS				0XB03,R24			; PONE UN 1  ACTIVAR EN ESPERA		
; CAMBIAR EN PANTALLA COLOR AL NUMERO 6 "CUENTA"
		LDI			R16,54				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 06
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE		; VA A PANTALLA CUENTA

RUT_RETARDO_1A:


	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
	RJMP			RUT_RETARDO_1A		; AJUSTE DE SEGUNDO
	CLT									; PONE A CERO EL BIT T DE SREG
	BLD				CONTROL_1,0			; PASA EL REGISTRO T A CONTROL_1
	DEC				R19
	BRBS			1,RUT_2_C			; SI LLEGA A CERO SALTA A RUT_2_B SI NO NO
;	MOV				R24,R19
;	STS				UDR1,R24			; ENVIA POR LA RS EL TIEMPO DE RETARDO
;	CALL CADENA_UART
; PRESENTACION DE TIEMPO QUE FALTA
; ESCRIBE LINEA 1 " EN ESPERA
	LDI				R16,192			; 11000000 escribir en linea 1 linea (192)
	CALL			ENVINT
	LDI				YH,HIGH(EN_ESPERA)	; POSICION ALTA DEL TAXTO EN RAM
	LDI				YL,LOW (EN_ESPERA)	; direccion BAJA DEL TEXTO EN RAM      	
  	LDI				R17,20 				; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA

; ESCRIBE LINEA 2
	MOV				R24,R19
	CALL			RADC
	STS				$6A3,R1
	STS				$6A4,R2
	STS				$6A5,R3
	LDI				R16,148			; 11000000 escribir en linea 2 linea (192)
	CALL			ENVINT
	LDI				YH,HIGH (N_SEG)		; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL,LOW  (N_SEG)		; direccion BAJA DEL TEXTO EN RAM      	
  	LDI				R17,20 				; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
; ENVIA SEGUNDOS DE ESPERA A NEXTION
PUSH	R19							; SALVA EL CONTROL DE SEGUNDOS ENESPERA
		LDI			R19,116			; ENVIA UNA t
		LDI			R27,57			; TEXTO 9
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_ESP)	
		LDI			YL,LOW (N_ESP)
		CALL		P_NEXTION_TEXTO	
POP		R19							; RECUPERA LOS SEGUNDOS EN ESPERA


; NUEVA MEDICION DE SAL SI ES MAYOR DE 08 SALE SI NO SIGUE CONTANDO
	CALL			LEC_TEC				; LEE EL TECLADO
	CPI				R17,0B01111111		; SI SE PULSA LA TECLA SALIR
	BREQ			RUT_2_C				; VA A RUT_2_C	Y SALE
	LDS				R17,RG_232+1		; LEE EL CODIGO ENVIADO POR NEXTION
	CPI				R17,100				; 100 ENVIADO POR NEXTION AL PULSAR SALIR
	BREQ			RUT_2_C				; VA A RUT_2_C	Y SALE
	LDI				R18,P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
	LDS				R26,RAMC_SAL		; NUMERO DE MEDICIONES	
	CALL			ADC_P
;	LDS				R18,RAM_MED_INI_SAL	; CARGA EL ERROR INICIAL DEL TLC27 EN R18
;	SUB				R24,R18
	CPI				R24,8
	BRBS			0,RUT_RETARDO_1A	; SI ES MENOR SIGUE CONTANDO

RUT_2_C:
	LDI				R24,0
	STS				0XB03,R24			; PONE UN 0  DESACTIVAR EN ESPERA	

	RET
