; PARA ENVIAR UN RECUADRO VERDE  LA PANTALLA 4
;page 4
;draw 30,21,450,244,GREEN
;draw 29,20,451,245,GREEN






; RUTINA PARA ENVIAR DATOS A LA PANTALLA NEXTION  DE 480X272
; EN R16 INDICAR EL NUMERO DE LINEA EN HY HIGK Y HY LOW LA POSICION DE INICIO EN RAN
.equ		N_PRO	=0x956			; NIVEL DE PRODUCCION
.equ		N_POL	=0x9AA			; CAMBIO POLARIDAD
.equ		N_PHP	=0x96B			; PH PROGRAMADO
.equ		N_TEM	=0x65D			; TEMPERATURA ( TAMBIEN VALE 738
.equ		N_ELE	=0x9E3			; USO DEL EQUIPO HORAS ENVIAR 4 BIT
.equ		N_VEL	=0x7A0			; VIDA DEL ELECTRODO %
.equ		N_SALC	=0x905			; NIVEL DE SAL EN EL AGUA CALIBRACION
.equ		N_SALP	=0x7C5			; PROGRAMADA
.equ		N_PH	=0x46D			; PH DEL AGUA 46D CALIBRAR
.equ		N_RDP	=0x92D			; REDOX PROGRAMADO 
.equ		N_RD	=0x9BB			; REDOX DEL AGUA
.equ		N_CLP	=0x992			; CLORO PROGRAMADO
.equ		N_CL	=0X9CE			; CLORO EN LA PISCINA
.equ		N_FLU	=0xA1D			; SENSOR DE FLUJO		
.equ		N_ESP	=0x6A3			; EN ESPERA SEGUNDOS
.equ		N_BAR	=0x56E			; VALOR MINUTOS ???????
.equ		N_PAG	=0X9FC			; TEXTO EN RAM (page 0) enviar 6 caracteres incluye espacio
.equ		N_VAL	=0xA10			; TEXTO EN RAM (j0.VAL=) enviar 7 caracteres
.equ		N_TXT	=0xA0B			; TEXTO EN RAM (.txt=) enviar 5 caracteres
.equ		N_PIC	=0xA04			; TEXTO EN RAM (pic ) enviar 4 caracteres incluido el espacio
.equ		N_AUT	=0x9C6			; TEXTO "AUTO"
.equ		N_TRD	=0xA4C			; TEXTO "Redox en mmV"
.equ		N_TCL	=0xA60			; TEXTO "Cloro ppm"
.equ		N_POS	=0xA18			; 0 O 1 SEGUN POSICION DE POLARIDAD DIRECTA O INVERSA LED NARANJA
.equ		N_NO	=0xA1E			; POSICION DEL TEXTO NO
.equ		N_SI	=0xA20			; POSICION DEL TEXTO SI PARA FLUJO
.equ		N_P00	=0xA6E			; ORDEN DEL NEXTION AL MICRO IR A PAGINA CERO
.equ		N_POL1	=0xA74			; POSICION ANAGRAMA DE POLARIDAD CON CIRCULO 1 o 2


; RUTINA PARA LA TRANSMISION DE DATOS A TRAVES DE LA UART
; CONFIGURAR A 9600 EN UBRRH Y UBRRL VALORES 00 Y 33

;  ******************************************************************************************************************


; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high (R29)  E  YL,low(R28)) EN R16 NUMERO DE CARACTERES
UARTN_TXC_RAM2:
;		LDI   		R16,20     		; longitud de texto a TRANSMITIR
		RCALL		UART_TXC1		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
UARTN_TXC_RAM_2A:
    	LD			R0,Y+
		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		DEC   		R16      		; Hemos terminado..?? 
		BRNE  		UARTN_TXC_RAM_2A	; NO...seguimos cargando 
		RET

P_NEXTION_TEXTO:	; ENVIAR TEXTO INICIAL  t1.txt=" TEXTO "  EN R26 Y R27 LINEA A ENVIAR EN YH HIG E YH LOW TEXTO A ENVIAR

;		LDI			R19,116			; ENVIA UNA t
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO		
		OUT 		UDR0,R27		; PONE LA LINEA A ESCRIBIR UNIDADES
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,46			; ENVIA UNA .
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,116			; ENVIA UNA t
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,120			; ENVIA UNA x
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,116			; ENVIA UNA t
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO		
		LDI			R19,61			; ENVIA UN =
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
		LDI			R19,34			; ENVIA UN "
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
P_NEXTION_LINEA:
; ENVIA UNA LINEA DE 20 CARACTERES
		CALL		UARTN_TXC_RAM2	; ENVIA LA 20 CARACTERES DE RAM Y TERMINA
		LDI			R19,34			; ENVIA UN "
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO

; ENVIA 3 FF
P_NEXTION_FINAL:
		LDI			R19,0xFF			; ENVIA UN FF
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,0xFF			; ENVIA UN FF
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		LDI			R19,0xFF			; ENVIA UN FF
		OUT			UDR0,R19
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		RET




; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high  E  YL,low)  EN R26 NUMERO DE CARACTERES
UARTN_TXT_RAM3:
;		LDI   		R26,20     		; longitud de texto a TRANSMITIR
		RCALL		UART_TXC1		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
UARTN_TXT_RAM_3A:
    	LD			R0,Y+
		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		DEC   		R26     		; Hemos terminado..?? 
		BRNE  		UARTN_TXT_RAM_3A	; NO...seguimos cargando 
		RET		

INI_NEXTION_P:		;*********************************"PANTALLA PRINCIPAL"************************************************** 
	LDS			R18,RG_232+1		; ES LA POSICION DONDE GRABA LA PANTALLA DONDE ESTA SE USA EN LA RUTINA PAGE
	CPI				R18,9	
	BRBC			1,INI_NEXTION_P1	; SI ESTA LA NEXTION EN PANTALLA DE DATOS DEL EQUIPO NO VERIFICA NADA MAS
	RET

INI_NEXTION_P1:
; t0 ENVIA MODELO DEL EQUIPO         t0 CARACTERES 20 PANTALLA INFORMACION Y PRINCIPAL
		LDI			R19,116			; ENVIA UNA t			
		LDI			R27,48			; TEXTO 0 
		LDI			R16,20			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(LIN1P)
		LDI			YL,LOW(LIN1P)
		CALL		P_NEXTION_TEXTO

; t1 ENVIA HORAS CAMBIO DE POLARIDAD t1 CARACTERES 1
;		LDI			R19,116			; ENVIA UNA t
;		LDI			R27,49			; TEXTO 1
;		LDI			R16,1			; NUMERO DE CARACTERES A ESCRIBIR
;		LDI			YH,HIGH(N_POL)
;		LDI			YL,LOW (N_POL)	; PARA ENVIAR UN 52 ASCI DEL 4
;		CALL		P_NEXTION_TEXTO	

; t2 ENVIA NIVEL DE SAL EN EL AGUA	t2 EN PRINCIPAL Y PARAMETROS	
		LDI			R19,116			; ENVIA UNA t
		LDI			R27,50			; TEXTO 2
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_SALP)
		LDI			YL,LOW (N_SALP)
		CALL		P_NEXTION_TEXTO	

; t3 ENVIA EL PH DEL AGUA	        t3 ENVIAR 3 CARACTERES EN PANTALLA PRINCIPAL Y CALIBRACION	
		LDI			R19,116			; ENVIA UNA t
		LDI			R27,51			; TEXTO 3
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_PH)
		LDI			YL,LOW (N_PH)
		CALL		P_NEXTION_TEXTO	


SBRC		CONTROL,7				; SI HAY SONDA DE CLORO NO PONE EL PORCENTAJE PONE AUTO y TEXTO EN t6 "Cloro ppm"
RJMP		N_NEXTION_P1C
SBRC		CONTROL,6				; SI HAY SONDA DE REDOX NO PONE EL PORCENTAJE PONE AUTO Y TEXTO EN t6 "Redox en mmV"
RJMP		N_NEXTION_P1R

; t5 ENVIA PORCENTAJE DE PRODUCCION t5 CARACTERES 3 PANTALLA PRINCIPAL Y PARAMETROS O DATOS DE CLORO O REDOX
		LDI			R19,116			; TEXTO t
		LDI			R27,53			; TEXTO 5
		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_PRO)
		LDI			YL,LOW  (N_PRO)
		CALL		P_NEXTION_TEXTO
		RJMP		N_NEXTION_P2

N_NEXTION_P1C: ; PONE AUTO Y TEXTO "Cloro ppm" EN t6
		LDI			R19,116			; TEXTO t
		LDI			R27,53			; TEXTO 5
		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_AUT)
		LDI			YL,LOW  (N_AUT)
		CALL		P_NEXTION_TEXTO
		LDI			R19,116			; TEXTO t
		LDI			R27,54			; TEXTO 6
		LDI			R16,10			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_TCL)
		LDI			YL,LOW  (N_TCL)
		CALL		P_NEXTION_TEXTO

; t4 ENVIA EL CLORO DEL AGUA
		LDI			R19,116			; TEXTO t
		LDI			R27,52			; TEXTO 4
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_CL)
		LDI			YL,LOW (N_CL)
		CALL		P_NEXTION_TEXTO	

; ENVIA EL NIVEL DE CLORO PROGRAMADO
		LDI			R19,116			; TEXTO t
		LDI			R27,57			; TEXTO 9
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_CLP)
		LDI			YL,LOW (N_CLP)
		CALL		P_NEXTION_TEXTO	
		RJMP		N_NEXTION_P2

N_NEXTION_P1R: ; PONE AUTO Y TEXTO "Redox en mmV"
		LDI			R19,116			; TEXTO t
		LDI			R27,53			; TEXTO 5
		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_AUT)
		LDI			YL,LOW  (N_AUT)
		CALL		P_NEXTION_TEXTO
		LDI			R19,116			; TEXTO t
		LDI			R27,54			; TEXTO 6
		LDI			R16,10			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_TRD)
		LDI			YL,LOW  (N_TRD)
		CALL		P_NEXTION_TEXTO
; t4 ENVIA EL REDOX DEL AGUA		t4 EN PANTALLA PRINCIPAL Y CALIBRACION
		LDI			R19,116			; TEXTO t
		LDI			R27,52			; TEXTO 4
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_RD)
		LDI			YL,LOW (N_RD)
		CALL		P_NEXTION_TEXTO	

; t9 ENVIA EL REDOX PROGRAMADO TEXTO t9
		LDI			R19,116			; ENVIA UNA t
		LDI			R27,57			; TEXTO 9
		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_RDP)
		LDI			YL,LOW (N_RDP)
		CALL		P_NEXTION_TEXTO	

N_NEXTION_P2:

; j0 ENVIA EL VALOR PARA LA BARRA PROGRESIVA (j0.val=90)
;		RCALL		P_NEXTION_VAL	; ENVIA EL VALOR DE LA PRODUCCION PARA LA BARRA Y TERMINA CON 0xFF

; j7 ENVIA LOS MINUTOS TEXTO EN LA BARRA
		LDI			R19,106			; ENVIA UNA J
		LDI			R27,55			; TEXTO 7
		LDI			R16,2			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_BAR)
		LDI			YL,LOW  (N_BAR)
		CALL		P_NEXTION_TEXTO

; ENVIA EL COLOR DE FONDO DE PRODUCCION. GRIS O VERDE
		SBIC		PORTD,4
		RJMP		N_NEXTION_P3
		LDI			R26,12				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
		LDI			R19,53				; UN 5 QUE ES EL TEXTO PRODUCCION
		STS			0xA25,R19
		LDI			YH,HIGH(ROJO)		; CAMBIA EL COLOR DEL FONDO Y LO PONE GRIS CON PRODUCION
		LDI			YL,LOW(ROJO)
		CALL		UARTN_TXT_RAM3
		CALL		P_NEXTION_FINAL 	; ENVIA 3 0xFF
		RJMP		N_NEXTION_P4
N_NEXTION_P3:
;		CALL		UART_INI1
		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
		LDI			R19,53				; POSICION EN RAM DEL NUMERO DEL TEXTO PRODUCCION
		STS			0xA39,R19
		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
		LDI			YH,HIGH(VERDE)		; CAMBIA EL COLOR DEL FONDO Y LO PONE VERDE CON PRODUCION
		LDI			YL,LOW(VERDE)
		CALL		UARTN_TXT_RAM3
		CALL		P_NEXTION_FINAL

N_NEXTION_P4:	; ENVIA POSICION DE POLARIDAD 1 O 2 LEE LOS LED ES EL LED 7
; t8 ENVIA LA POLARIDAD ACTIVA 1 O 2
		LDI			R19,49				; PONE UN 1
		SBRS		VAL_LED,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
		LDI			R19,50				; PONE UN 2
		STS			N_POS,R19			; GRABA EN RAM en 1 o un 2
		LDI			R19,116				; ENVIA UNA t			
		LDI			R27,56				; TEXTO 8 
		LDI			R16,1				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_POS)
		LDI			YL,LOW(N_POS)
		CALL		P_NEXTION_TEXTO		


N_NEXTION_PH:					; ENVIA SEÑAL DE BOMBA DE PH EN MARCHA "VERDE" O PARADA "GRIS"
		SBRC		VAL_LED,4			; SALTA LA PROXIMA INSTRUCION SI ES UNO, LED DE PH ENCENDIDO
		RJMP		N_NEXTION_PH1
		LDI			R19,55				; UN 7 QUE ES EL TEXTO A ENVIAR
		STS			0xA25,R19
		LDI			R26,12				; NUMERO DE CARACTERES A ENVIAR
		LDI			YH,HIGH(ROJO)		; CAMBIA EL COLOR DEL FONDO Y LO PONE rojo CON PRODUCION
		LDI			YL,LOW(ROJO)
		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF
		RJMP		N_NEXTION_PH2

N_NEXTION_PH1:
		LDI			R19,55				; POSICION EN RAM DEL NUMERO DEL TEXTO A ENVIAR UN 7
		STS			0xA39,R19
		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
		LDI			YH,HIGH(VERDE)		; CAMBIA EL COLOR DEL FONDO Y LO PONE VERDE CON PRODUCION
		LDI			YL,LOW(VERDE)
		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF

N_NEXTION_PH2:							;j6 0x96B			; PH PROGRAMADO
; envia ph programado
		LDI			R19,106				; ENVIA UNA j
		LDI			R27,54				; TEXTO 6
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_PHP)
		LDI			YL,LOW (N_PHP)
		CALL		P_NEXTION_TEXTO		
RET
; ENVIA ANAGRAMA POLARIDAD 1 o 2 CON CIRCULO PIC 36 Y 35 RESPACTIVAMENTE

		LDI			R19,54				; PONE UN 6
		SBRS		VAL_LED,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
		LDI			R19,53				; PONE UN 5
		STS			0xA80,R19			; GRABA EN RAM en 1 o un 2
		LDI			R26,13				; NUMERO DE CARACTERES A ENVIAR
		LDI			YH,HIGH(N_POL1)		; CAMBIA EL COLOR DEL FONDO Y LO PONE rojo CON PRODUCION
		LDI			YL,LOW(N_POL1)
		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF


; *******************OPCIONAL ENVIA UN RETORNO DE CARRO *******************************
;		LDI			R16,13				; ENVIA 13
;		OUT 		UDR0,R16			; pone el valor de dato en el registro de transmision
		RET

;				******************TERMINA PANTALLA PRINCIPAL*************************************
;             	*********************************PANTALLA INFORMACION*****************************
INI_NEXTION_I:

		CALL		HORAS				; ACTUALIZA LAS HORAS DE USO DEL EQUIPO
;  ENVIA HORAS DE USO DEL EQUIPO   i1 CARACTERES 4 PANTALLA INFORMACION
		LDI			R19,105				; ENVIA UNA i
		LDI			R27,49				; TEXTO 1
		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_ELE)	
		LDI			YL,LOW (N_ELE)
		CALL		P_NEXTION_TEXTO	

;  PORCENTAJE DE USO DEL ELECTRODO i2 CARACTERES 3 PANTALLA INFORMACION
		LDI			R19,105				; ENVIA UNA i
		LDI			R27,50				; TEXTO 2
		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_VEL)
		LDI			YL,LOW (N_VEL)
		CALL		P_NEXTION_TEXTO	


;  TEMPERATURA DEL AGUA				i3 CARACTERES 3 PANTALLA INFORMACION
		LDI			R19,105				; ENVIA UNA i
		LDI			R27,51				; TEXTO 3
		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_TEM)
		LDI			YL,LOW (N_TEM)
		CALL		P_NEXTION_TEXTO	

;  SENSOR DE FLUJO				i4 CARACTERES 3 PANTALLA INFORMACION
		LDI			R19,105				; ENVIA UNA i
		LDI			R27,52				; TEXTO 4
		LDI			R16,2				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_FLU)
		LDI			YL,LOW (N_FLU)
		CALL		P_NEXTION_TEXTO	

; ENVIA UNA VEZ POR SEGUNDO Y CUENTA SEGUNDOS HASTA 10 VIENE DE LA ULTIMA LINEA DE LECTURA TECLADO 
N_PRU:
		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
		RJMP		N_PRU
		CLT								; PONE A CERO EL BIT T DE SREG
		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
		DEC			R31					; DESCUENTA UN SEGUNDO	
		BRNE		N_PRU1
		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE
		RET
N_PRU1:
		LDS			R16,RG_232+1		; LEE EL VALOR ENVIADO POR LA PANTALLA TECLA SALIR
		CPI			R16,00				; COMPARA R16 CON 00
		BRNE		INI_NEXTION_I		; SALTA ESTA INSTRUCION SI NO ES IGUAL
		LDI			R16,48
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE
		RET



; 		*************************************************  TERMINA PANTALLA INFORMACION *********************************
; 		************************************************* PROGRAMACION DE LOS PARAMETROS ********************************
INI_NEXTION_PA:

; ENVIA PORCENTAJE DE PRODUCION	PROGRAMADO		t5
		LDI			R19,116				; TEXTO t
		LDI			R27,53				; TEXTO 5
		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_PRO)
		LDI			YL,LOW  (N_PRO)
		CALL		P_NEXTION_TEXTO

;  ENVIA EL PH PROGRAMADO              	j6 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
		LDI			R19,106				; ENVIA UNA j
		LDI			R27,54				; TEXTO 6
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_PHP)
		LDI			YL,LOW (N_PHP)
		CALL		P_NEXTION_TEXTO		


;  ENVIA EL RD	                	j7 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
		LDI			R19,106				; ENVIA UNA j
		LDI			R27,55				; TEXTO 7
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_RDP)
		LDI			YL,LOW (N_RDP)
		CALL		P_NEXTION_TEXTO		

; ENVIA HORAS CAMBIO DE POLARIDAD 	j5 CARACTERES 1
		LDI			R19,106				; ENVIA UNA j
		LDI			R27,53				; TEXTO 5
		LDI			R16,1				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_POL)
		LDI			YL,LOW (N_POL)		; PARA ENVIAR UN 52 ASCI DEL 4
		CALL		P_NEXTION_TEXTO	

; ENVIA EL NIVEL PROGRAMADO DE CLORO j8
		LDI			R19,106				; ENVIA UNA j
		LDI			R27,56				; TEXTO 8
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_CLP)
		LDI			YL,LOW (N_CLP)		; PARA ENVIAR UN 52 ASCI DEL 4
		CALL		P_NEXTION_TEXTO	


N_PRUA:
		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
		RJMP		N_PRUA
		CLT								; PONE A CERO EL BIT T DE SREG
		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
		DEC			R31					; DESCUENTA UN SEGUNDO
		BRNE		N_PRU1A
		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
		RET

N_PRU1A:			
		LDS			R18,RG_232
		CPI			R18,0x71
		BRBC		1,N_PRU2A			; SI DISTINTO VA A N_PRU2A
		CALL		N_PRO_PAR			; PROGRAMAR PARAMETROS LEYENDO RG_232+1
		RJMP		INI_NEXTION_PA
N_PRU2A:
		LDS			R18,RG_232+1
		CPI			R18,00				; 
		BRBC		1,INI_NEXTION_PA	; SI ES DISTINTO VA A INI_NEXTION_PA

		LDI			R16,48
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE		; ENVIA NEXTION A PAGINA 0
		RET

;           *********************************** TERMINA PANTALLA PARAMETROS ***************************
;			*********************************** PANTALLA CALIBRACION **********************************

;  PANTALLA CALIBRACION

INI_NEXTION_CA:

; t2 ENVIA NIVEL DE SAL EN EL AGUA	t2 EN PRINCIPAL Y PARAMETROS	
		LDI			R19,116				; ENVIA UNA t
		LDI			R27,50				; TEXTO 2
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_SALC)
		LDI			YL,LOW (N_SALC)
		CALL		P_NEXTION_TEXTO			


;t3  ENVIA EL PH DEL AGUA           t3 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
		LDI			R19,116				; ENVIA UNA t
		LDI			R27,51				; TEXTO 3
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_PH)
		LDI			YL,LOW (N_PH)
		CALL		P_NEXTION_TEXTO			

;t4 ENVIA EL REDOX DEL AGUA			c8 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES
		LDI			R19,116				; ENVIA UNA t
		LDI			R27,52				; TEXTO 4
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_RD)
		LDI			YL,LOW (N_RD)
		CALL		P_NEXTION_TEXTO


;c7 ENVIA EL CLORO DEL AGUA			c7 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES
		LDI			R19,99				; ENVIA UNA C
		LDI			R27,55				; TEXTO 7
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_CL)
		LDI			YL,LOW (N_CL)
		CALL		P_NEXTION_TEXTO	
.
N_PRUB:
		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
		RJMP		N_PRUB
		CLT								; PONE A CERO EL BIT T DE SREG
		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
		DEC			R31					; DESCUENTA UN SEGUNDO
		BRNE		N_PRU1B
		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
		RET

N_PRU1B:			
		LDS			R18,RG_232
		CPI			R18,0x71
		BRBC		1,N_PRU1C
		CALL		N_PRO_PAR
		RJMP		INI_NEXTION_CA
N_PRU1C:
		LDS			R16,RG_232+1
CPI		R16,9				; SI SE HA PULSADO LA TECLA DE DATOS EQUIPO
BRBC	1,N_PRU1D
LDI		R16,57				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 09
STS		0xA01,R16
CALL	P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
RET
N_PRU1D:
		CPI			R16,00
		BRBC		1,INI_NEXTION_CA	; SI NO ES CERO VA A INI_NEXTION_CA
		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
		STS			0xA01,R16
		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
		RET

;   ******************************************TERMINA PANTALLA CALIBRACION *****************************
;	****************************************** PANTALLA SEGUNDOS DE ESPERA *****************************
N_ESPERA:
; tE ENVIA LOS SEGUNDOS DE ESPERA	tE SEGUNDOS DE ESPERA PARA LA PANTALLA DE CUENTA ENVIA 3 CARACTERES
		LDI			R26,116				; ENVIA UNA t
		LDI			R27,69				; ENVIA UNA E
		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH(N_ESP)
		LDI			YL,LOW (N_ESP)
		CALL		P_NEXTION_TEXTO	

		RET


; ENVIA ANAGRAMA PEQUEÑO DE TEAP  REQUIERE ENVIA PRIMERO (pic) LUEGO COORDENADAS X E Y, Y CODIGO DEL DIBUJO QUE ES 29
P_NEXTION_TEAP:
		CALL		P_NEXTION_PIC	; ENVIA pic Y  UN ESPACIO
		LDI			R19,52			; 4
		CALL		P_NEXTION_BIT
		LDI			R19,51			; 3
		CALL		P_NEXTION_BIT
		LDI			R19,53			; 5
		CALL		P_NEXTION_BIT
		LDI			R19,44			; ,
		CALL		P_NEXTION_BIT
		LDI			R19,49			; 1
		CALL		P_NEXTION_BIT
		LDI			R19,51			; 3
		CALL		P_NEXTION_BIT
		LDI			R19,55			; 7
		CALL		P_NEXTION_BIT
		LDI			R19,44			; ,
		CALL		P_NEXTION_BIT
		LDI			R19,50			; 2
		CALL		P_NEXTION_BIT
		LDI			R19,57			; 9
		CALL		P_NEXTION_BIT
		JMP			P_NEXTION_FINAL	; ENVIA FIN CADENA Y RETORNA

; ENVIAR PIC DIBUJO POSICION X R24 POSICION Y R25 DIBUJO R26
P_NEXTION_PIC:				; 		envia pic y un espacio 4 caracteres

		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_PIC)
		LDI			YL,LOW  (N_PIC)
		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
		RET	

P_NEXTION_VAL:					; PARA LA BARRA PROGRESIVA ENVIAR (j0.val=80)
; ENVIA j0.val=
		LDI			R16,7			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_VAL)
		LDI			YL,LOW  (N_VAL)
		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION

; ENVIA EL VALOR DE MINUTOS
		LDI			R16,2			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_BAR)
		LDI			YL,LOW  (N_BAR)
		RCALL		UARTN_TXC_RAM2	; ENVIA 2 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
		RCALL		P_NEXTION_FINAL	; ENVIA 3 FF Y TERMINA
		RET


P_NEXTION_PAGE:		; ENVIAR CAMBIO DE PAGINA **PAGE 0**	ESCRIBIR EN RAM PASICION A01 EL NUMERO DE LA PAGINA
		LDI			R16,6			; NUMERO DE CARACTERES A ESCRIBIR
		LDI			YH,HIGH (N_PAG)
		LDI			YL,LOW  (N_PAG)
		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
		JMP			P_NEXTION_FINAL	; ENVIA 3 FF Y TERMINA


; NEXTION ENVIAR UN BIT EN R19 Y UNA COMA
P_NEXTION_BIT:
;		LDI			R19,32
		STS			UDR0,R19		; ENVIA UN ESPACIO EN BLANCO
		CALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
		RET

; ACTUALIZAR VALOR DE TEMPERATURA, HORAS DE USO Y VIDA DEL ELECTRODO
P_NEXTION_AC:

		LDI			R18,P_TEMP			; LINEA A LEER
		LDI			R26,80				; NUMERO DE LECTURAS
		CALL		ADC_P
;LDI R24,00
		STS			RAM_TEMP,R24		; GUARDA LA LECTURA EN LA MEMORIA RAM
		CALL		PCF2_T				; RUTINA QUE PREPARA LA PRESENTACION DE LA TEMPERATURA
		CALL		HORAS				; PRESENTA HORAS Y AMPERIOS (PROD CLORO)
		SBRC		CONTROL_1,6			; SALTA LA PROXIMA INSTRUCION SI ES CERO, CONTROL DE FLUJO
		RJMP		P_NEXTION_AC1		; SI ES CERO A P_NEXYION_AC1 Y DEJA EL NO, "NO PONE EL SI"
; CAMBIA TEXTO EN 0x7A0 NO POR SI

		LDI			R19,83				; UNA S
		STS			0xA1D,R19			
		LDI			R19,73				; UNA I
		STS			0xA1E,R19
P_NEXTION_AC1:
		RET








	
