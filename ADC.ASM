

; EN R24 EL RESULTADO EN R26 EL NUMERO DE MEDICIONES
; PROGRAMA LECTOR CONVERTIDOR ANALOGICO DIGITAL
; EN R18 EL CANAL A LEER
; EN ADCH LOS 8 BIT MAS SIGNIFICAATIVOS
; EN ADCL BIT 6 Y 7 LOS DOS MENOS SIGNIFICATIVOS

; REGISTRO ADMUX
;  REFS1 REFS0 ADLAR MUX4 MUX3 MUX2 MUX1 MUX0
;     7     6     5    4    3    2    1    0
;REFS1 REFS0 Voltage Reference Selection
;	0 		0 AREF, Internal Vref turned off
;	0 		1 AVCC with external capacitor at AREF pin
;	1	 	0 Reserved
;	1 		1 Internal 2.56V Voltage Reference with external capacitor at AREF pin
; ADLAR configura la forma de almacenar el resultado en ADCH Y ADCL
; MUXx  SELECIONA LA ENTRADA Y AMPLIFICACION DE LA MISMA VER PAG 218

; REGISTRO ADCSRA
;  ADEN ADSC ADATE ADIF ADIE ADPS2 ADPS1 ADPS0
;    7    6     5    4    3     2     1     0
; ADEN 	A UNO ACTIVA LA CONVERSION ADC
; ADSC 	EMPIZA LA CONVERSION AL TERMINAR SE PONE A CERO
; ADATE	AUTO TRIGER ESTA ACTIVO AL PONER UN UNO
; ADIF	SE ACTIVA LA INTERRUPCION AL PONER UN UNO
; ADIE	ACTIVA LA INTERRUPCION CUANDO TERMINA SI ESTE BIT ESTA A UNO
; ADPS	DETERMINA EL FACTOR DE DIVISION ENTRE LA FRECUENCIA DEL MICRO Y LA DE LA DIVISION ADC
;Table 85. ADC Prescaler Selections
;ADPS2   ADPS1  ADPS0 Division Factor
;	0 		 0 		0 	2
;	0 		 0		1 	2
;	0 		 1 		0 	4
;	0 		 1 		1 	8
;	1 		 0 		0 	16
;	1 		 0 		1 	32
;	1 		 1 		0 	64
;	1		 1 		1 	128


;PCF_B:

;PCF_C:


ADC_P:	;PONE EL PUERTO A COMO ENTRADA DE DATOS A CERO


	CLR				R24
	CLR				R1 


; CONFIGURAR TENSION DE REFERENCIA A VDD, FORMA DE ALMACENAMIENTO CON EL REGISTRO ADLAR A 1 Y CANAL A LEER
;	LD1				R16, (0<<REFS1)|(1<<REFS0)|(0<<ADLAR) LEER LINEA ADC0 ES LA PATA 40
	LDI				R16,0B11100000		; SEÑAL INTERNA DE REFERENCIA A  VDC BIT 7Y6 
										; BIT DE ADLAR A 1 
	ADD				R16,R18				; EN R18 EL CANAL A LEER Y GANANCIA VER PAG 245
	OUT				ADMUX,R16

ADC_P1:
	LDI				R16,0B11010111		; PREESCALA A 128 "8.000.000/128=62.500Hz
;	LDI				R16,0XCB
	OUT				ADCSRA,R16

ADC_P2:
	LDI				R25,250				; RETARDO PARA LA VISUALIZACION
	RCALL			RETARDO
	LDI				R25,250				; RETARDO PARA LA VISUALIZACION
	RCALL			RETARDO
	IN				R16,ADCSRA
	NOP
	BST				R16,6				; CARGA EN EL REGISTRO T DE SREG EL 6 ACSRA
	BRTS			ADC_P2				; SALTA A ADC_P1 SI EL REGISTRO ES UNO SE PONE A CERO AL TERMINAR 
	DEC				R26					; R26 CONTIENE EL NUMERO DE LECTURAS
	BREQ			ADC_P3_A			; SI R26 LLEGA A CERO TERMINA
	IN	 			R17,ADCH
	ADC				R1,R17				; SUMA EL RESULTADO A R1
	BRCC			ADC_P1				; SI NO HAY DESBORDAMIENTO SALTA A ADC_P1
	INC				R24
	RJMP			ADC_P1
ADC_P3_A:
RET
ADC_P3:	; RESTAURA LOS VALORES DEL PUERTO A ALMACENA EN MEMORIA Y CONFIGURA LA LINEA DE PRESENTACION
	STS				RAM_TEMP,R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
	LDI				R16,48				; PONE UN 0
	STS				0x30F,R16
	LSR				R24					; SI ES PAR
	BRCC			ADC_P4				; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
	LDI				R16,53				; PONE UN CINCO EN LUGAR DEL 0
	STS				0x30F,R16
ADC_P4:
	RCALL			RADC
	STS				0x30C,R2
	STS				0X30D,R3
; PARA SUSTITUIR EL VALOR MAXIMO 40 GRADOS POR --.-
	LDS				R18,RAM_TEMP
	LDI				R25,80
	RCALL			COMP
	SBRS			CONTROL,0			; VERIFICA SI ES UNO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
	RJMP			ADC_P5				; POR SI NO HAY SONDA PT1000  O LA TEMP. ES MAYOR DE 25ºC
	LDI				R18,45				; PONE UN - EN LUGAR DE LOS NUMEROS
	STS				0x30C,R18
	STS				0x30D,R18
	STS				0x30F,R18
ADC_P5:
	RET
	LDI				R16,00
	OUT				ADMUX,R16
	OUT				ADCSRA,R16
	RET

