; CONTADOR HORAS


									; SE PRESENTA EL RESULTADO


HORAS:		; RECUPERA EL CONTENIDO DE LA EEPROM Y LO PASA A YH,YL

	LDI				R17, N_HORAS		; POSICION A LEER EN LA EEPROM
	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
	MOV				YL, R18
	LDI				R17, N_HORAS_1		; POSICION A LEER EN LA EEPROM
	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
	MOV				YH, R18
	CLR				R24					; CENTENAS
	CLR				R25					; UNIDADES DE MILLAR
	CLR				R26					; DECENAS DE MILLAR
	CLR				R27					; DECENAS
										; EN R28 UNIDADES REGISTRO YL
	CPI				YH, 1				; VERIFICAR QUE EL REGISTRO ALTO ES CERO
	BRLO			HORAS2
HORAS1:
	CPI				YH, 1				; COMPRUEBA QUE EL REGISTRO ALTO ES CERO
	BRLO			HORAS2				; SI MENOR DE 1 VA A HORAS2
	SBIW			YH:YL , 50			; RESTA 50 A LOS REGOSTROS
	SBIW			YH:YL , 50			; RESTA 50 A LOS REGISTROS TOTAL 100
	INC				R24					; INCREMENTA LAS CENTENAS EN 1
	CPI				R24, 10				; COMPRUEBA QUE NO SON 10
	BRLO			HORAS1				; Y SALTA A HORAS1 SI ES MENOR
	INC				R25					; INCREMENTA LAS UNIDADES DE MILLAR
	SUBI			R24, 10				; Y RESTA 10 A LAS CENTENAS
	CPI				R25, 10				; COMPRUEBA LAS UNIDADES DE MILLAR
	BRLO			HORAS1				; SI ES MENOR MENOR SALTA A HORAS1
	SUBI			R25,10				; RESTA 10 E..
	INC				R26					; INCREMENTA LAS UNIDADES DE MILLAR
	RJMP			HORAS1				; SALTA A HORAS1

HORAS2: ; DECODIFICA EL REGISTRO BAJO YL
	CPI				YL, 100				; COMPRUEBA SI SON 100
	BRLO			HORAS3				; SI ES MENOR SALTA A HORAS3				
	SUBI			YL, 100				; RESTA 100..
	INC				R24					; E INCREMENTA LAS CENTENAS
	CPI				R24, 10				; COMPRUEBA QUE ES 10...
	BRLO			HORAS2				; SI ES MENOR DE 10 SALTA A HORAS2 
	SUBI			R24, 10				; RESTA 10 A LAS CENTANAS..
	INC				R25					; E INCRAMENTA EN 1 LAS UNIDADES DE MILLAR
	CPI				R25, 10				; COMPRUEBA SI LAS UNIDADES DE MILLAR SON 10
	BRLO			HORAS2				; SI ES MENOR VA A HORAS2
	INC				R26					; INCREMENTA LAS DECENAS DE MILLAR
	RJMP			HORAS2				; SALTA A HORAS2

HORAS3:
	CPI				YL,10				; COMPARA CON 10
	BRLO			HORAS4				; SI ES MENOR SALTA A HORAS 4
	INC				R27					; INCREMENTA LAS DECENAS
	SUBI			YL, 10				; RESTA 10 
	RJMP			HORAS3				; SALTA A HORAS3	

HORAS4:		; PASA EL RESULTADO A CARACTER ASCI SUMANDO A LOS REGISTROS 48 Y PASANDOLOS A RAM
	LDI				R18, 48
	ADD				R24, R18
	ADD				R25, R18
	ADD				R26, R18
	ADD				R27, R18
	ADD				R28, R18
;	STS				$9E2, R26
	STS				$9E3, R25
	STS				$9E4, R24
	STS				$9E5, R27
	STS				$9E6, R28
; PARA LEER LOS VOLTIOS	
	LDI				R18, P_VFUENTE				; LINEA A LEER
	LDI				R26, 79				; NUMERO DE LECTURAS VOLTIOS
	CALL			ADC_P			
	CALL			RADC
	STS				$128, R1
	STS				$129, R2
	STS				$12B, R3
; PRESENTACION EN PANTALLA
	LDI				R18, 72				; IMPRIME LA H
	STS				$126, R18
	LDI				R16, 46				; PNE UN PUNTO
	STS				$12A, R16
	LDI				R18, 86				; IMPRIME LA V
	STS				$12D, R18	
	LDI				R18, 100			; IMPRIME LA d
	STS				$12E, R18
	LDI				R18, 99				; IMPRIME LA c
	STS				$12F, R18	
	LDI				R18, 32				; IMPRIME UN ESPACIO
	STS				$125,R18
	STS				$127,R18
	STS				$12C,R18
	STS				$130,R18
	STS				$131,R18
	STS				$132,R18
	STS				$133,R18
	CALL			LEC_TEC
	CPI				R17, 0B01111110		; PRESENTAR LOS VOLTIOS 	 	"PRO Y SALIR"
	BREQ			HORAS6
	LDI				R18,P_TCL			; LEE LOS AMPERIOS
	LDI				R26, 110			; NUMERO DE LECTURAS AMPERIOS
	CALL			ADC_P
	CPI				R24,4				; PARA QUE POR DEBAJO DE 2 GRAMOS PONGA CERO
	BRLO			HORAS5_1			; SI ES MENOR DE 3 VA A HORAS5_1
	RJMP			HORAS5_2

HORAS5_1:
	LDI				R24,00

HORAS5_2:
	LDI				R16, 48				; PONE UN CERO
	STS				0x12B,R16
	LSR				R24					; SI ES PAR
	BRCC			HORAS5				; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
	LDI				R16,53				; PONE UN CINCO EN LUGAR DEL 0
	STS				$12B,R16
HORAS5:
	CALL			RADC
	STS				$128,R2				; PARA MAESTRO AL PULSAR SALIR
	STS				$129,R3				; PARA MAESTRO AL PULSAR SALIR
	STS				$74B,R2				; PARA EL REMOTO 20X4
	STS				$74C,R3				; PARA EL REMORO 24X4
; PRESENTACION EN PANTALLA
	LDI				R18, 72				; IMPRIME LA H DE HORAS
	STS				$126, R18
	LDI				R16, 46				; PONE UN PUNTO
	STS				$12A, R16
	LDI				R18, 103			; IMPRIME LA g
	STS				$12D, R18	
	LDI				R18, 114			; IMPRIME LA r
	STS				$12E, R18
	LDI				R18,46				; IMPRIME UN .
	STS				$12F,R18
	LDI				R18, 67				; IMPRIME LA C
	STS				$130, R18	
	LDI				R18, 32				; IMPRIME UN ESPACIO
	STS				$125, R18
	STS				$127, R18
	STS				$12C, R18
	LDI				R16,108
	STS				$131,R16
	LDI				R16,47				; PONE UNA /
	STS				$132,R16
	LDI				R16,72
	STS				$133,R16

HORAS6:
;	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
;	CALL			ENVINT
;	LDI				YH, HIGH (L_HORAS)	; POSICION ALTA DEL TAXTO EN RAM 080
;	LDI				YL, LOW  (L_HORAS)	; direccion BAJA DEL TEXTO EN RAM      	
 ; 	LDI				R17,20 				; bytes a enviar 
;	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
;LDI R27, 1			; POSICION X LINEA 0 A 8
;LDI	R26, 3			; POSICION Y DE 0 A 16
;LDI	R24, 16		; NUMERO DE CARACTERES A ESCRIBIR
;LDI	YH, HIGH (L_HORAS)
;LDI	YL, LOW (L_HORAS)
;CALL PRO_GRA_1	

	RET




