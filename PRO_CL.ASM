; RUTINA DEL TECLADO PARA AJUSTE PORCENTAJE DE CLORO
TECLA3T:
	STS			RAMP_CL, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL CL
	LDI			R17, CL_MEN
	MOV			R18, R30			; GRABA EL VALOR DEL CLORO LIBRE EN EEPROM 242
	RCALL		EEPROM_ES
;	RCALL		I2CE_2404

	MOV			R16, VAL_LED
	ANDI		R16, 0B10111111
	MOV			VAL_LED, R16
	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
	RCALL		NO_TECLA
	RET

TECLA3U: ;GRABA EL VALOR DEL CLORO Y CARGA EL VALOR % PRODUCION
	STS			RAMP_CL, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL CL
;	LDI			R16, 00
	LDI			R17, CL_MEN
	MOV			R18, R30			; GRABA EL VALOR DEL CLORO LIBRE EN EEPROM 242
;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
	RCALL		EEPROM_ES
	RCALL		NO_TECLA
	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
	MOV			TEMP_TEC, R16
	RJMP		TECLA5V
TECLARD_CL: 		;VA A PROGRAMACION DEL APAYO DE CLORO
STS RAMP_CL,R30
CALL TECLA6V
TECLA3V:
	CPI			R22, RETARDO1
	BRLO		TECLA3V
	LDS			R30, RAMP_CL
	LDI			R22,0
TECLA3:							; AJUSTAR PH VALOR EN R30
	WDR
	MOV			R24, TEMP_TEC
	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
	BRPL		TECLA3T						; Y SALIR DE PROGRAMACION DE PARAMETROS					
	CALL		LEC_TEC
	CPI			R17, 000		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
	BREQ		TECLA3A			; SI SE HA PULSADO SALTA A TECLA2A
	LDI			R16, 00			; SI ES ASI....
	MOV			TEMP_TEC, R16			; PONE EL CONTADOR DE RETARDO A CERO
TECLA3A:
CPI	R17,0B11111110 ; VA A PROGRAMAR EL AJUSTE DE CORO Y REDOX
BREQ TECLARD_CL			; OPCION SALTAR PARA AJUSTE DE REDOX
;	CPI			R17, 0B00000100	; TECLA 6
	CPI			R17, 0B11111011	; IDEM
	BREQ		TECLA3U			; SALTA PARA AJUSTAR EL FACTOR DE PRODUCION
			; OPCION SALIR DE LECTURA DE TECLADO 
;	CPI			R17, 0B10000000	; TECLA 5 
	CPI			R17, 0B01111111 ; IDEM
	BRNE		TECLA3B			; SI NO ES 80 SALTA A TECLA1D
	RJMP		TECLA3T							; TERMINA Y SALE PARA GRABAR
TECLA3B:	; OPCION AUMENTAR RD
;	CPI			R17, 0b00010000	; TECLA 2 INCREMENTA EL VALOR
	CPI			R17, 0B11101111 ; IDEM
	BRNE		TECLA3C			; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
	MOV			TEMP_TEC, R16
	INC			R30				; INCREMENTA EL VALOR
	LDI			R22, 0			; CARGA EL RETARDO DE LECTURA DELTECLADO
	CPI			R30, CL_MAX		; VERIFICA SI ESTA EN EL VALOR MAXIMO
	BRLT		TECLA3C		; SI NO SUPERA EL VALOR MAXIMO SALTA
	LDI			R30, CL_MAX		; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
TECLA3C:	; OPCION DISMINUIR RD
;	CPI			R17, 0b00000010	; TECLA 2 PARA DISMINUIR
	CPI			R17, 0B11111101	; IDEM
	BRNE		TECLA3D			; SI NO ESTA PULSADA SALTA
	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
	MOV			TEMP_TEC, R16
	DEC			R30				; DISMINUYE EL VALOR
	LDI			R22, 0			; CARGA EL RETARDO DE LECTURA DEL TECLADO
	CPI			R30, CL_MIN		; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
	BRBC 		0, TECLA3D		; SI NO SE ALCANZA SALTA
	LDI			R30, CL_MIN		; SI SE ALCANZA PONE EL VALOR MINIMO
; *************OPCION AYUSTAR APOYO DE CLORO  **************************
TECLA3D:
	CPI			R17, 0B11111110		; TECLA 0 PARA VA A PROGRAMAR LA DIFERENCIA PARA EL APOYO DE REDOX
	BRNE		TECLA3D_1			; SI NO ESTA PULSADA SALTA
	CALL		TECLACL_RD

TECLA3D_1:	; PONER EL VALOR EN PANTALLA
	LDI			R22,00
	LDI			R24,32
	STS			$992,R24
	STS			$994,R24
	RCALL		PRO_TECLA
TECLA3E:
	CPI			R22, RETARDO3	; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
	BRLO		TECLA3E			; COMPRUEBA EL TIEMPO DE RETARDO 


	MOV			R24, R30		; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
	RCALL		RADC   			; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
	STS			$992, R2		; PONE EL RESULTADO EN PANTALLA DECENAS DE CL
	LDI			R16, 46
	STS			$993, R16
	STS			$994, R3		; PONE EL RESULTADO EN PANTALLA UNIDADES DE CL
	RCALL		PRO_TECLA
TECLA3F:
	CPI			R22, RETARDO2	; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
	BRLO		TECLA3F			; COMPRUEBA EL TIEMPO DE RETARDO 
	RJMP		TECLA3	
