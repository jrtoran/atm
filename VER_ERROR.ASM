
; PARA COMPROBAR EL TIPO DE ERROR
; SI ES AVERIA O FALSA CONEXION
VER_ERROR:
	
	LDI				R18, P_VSAL			; LINEA A LEER VOLTAJE DE SALIDA TENSION EN BORNAS
	LDI				R26, 83				; NUMERO DE LECTURAS
	CALL			ADC_P
	CPI				R24, 5				; SI LA MEDICION REAL ES MAYOR DE 0,5 NO EJECUTA LA SIGUIENTE INSTRU
	BRBC			0, VER_ERROR_A		; MEDICION MAYOR DE 5 
	RET

VER_ERROR_A:				; ENVIA ERROR DE CONEXION REVISAR CONEXION ELECTRODO

	CALL			APAGAR_FUENTE
	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
	MOV				R16, VAL_LED
	ANDI			R16, 0B11111110		; APAGA LED 0 FUENTE ENCENDIDA
	MOV				VAL_LED, R16	
	CALL			LEDPANT
	LDI				R16, 128			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
	LDI				YH, HIGH (F_CONEX)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL, LOW  (F_CONEX)	; direccion BAJA DEL TEXTO EN RAM  "EUIPO DETENIDO"    	
  	LDI				R17,20   			; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
	LDI				YH, HIGH (LIN_2S)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL, LOW  (LIN_2S)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
  	LDI				R17,20   			; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA 
	LDI				R16, 148			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
	LDI				YH, HIGH (CONEX_ELECT)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL, LOW  (CONEX_ELECT)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
  	LDI				R17,20   			; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA 
	LDI				R16, 212			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
	LDI				YH, HIGH (VER_SAL)	; POSICION ALTA DEL TAXTO EN RAM 080
	LDI				YL, LOW  (VER_SAL)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
  	LDI				R17,20   			; bytes a enviar 
	CALL			ENVIARTEXTO			; RUTINA PARA 
; ENVIA LA PAGINA 4 A NEXTION
		LDI			R16,52				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 04
		STS			0xA01,R16			; ESCRIBE EN RAM LA PAGINA A ENVIAR
		CALL		P_NEXTION_PAGE		; RUTINA PARA CAMBIAR DE PAGINA 


LDI				R19,1
STS				ERROR_ELECTRODO, R19	; PONE UN 1 EN ERROR CONEXION ELECTRODO
LDI				R19,0
STS				RAM_SAL_C,R19	
;	RJMP			VER_ERROR
VER_ERROR_B:
	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
RJMP			VER_ERROR_B
	CLT									; PONE A CERO EL BIT T DE SREG
	BLD				CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1

CALL 			CADENA_UART				; Y ENVIA LA CADENA COMPLETA Y LUEGO PARA A DORMIR

	RJMP			VER_ERROR_B
