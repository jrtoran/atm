;		RUTINA MED_RD UNA FRECUENCIA DE 2K CORRESPONDE A 147 IMPULSOS (147x5=735 VALOR DEL REDOX )
; EL VALOR DEL POTENCIAL REDOX SE OPTIENE DIVIDIENDO LA FRECUENCIA POR 3,8
; CALIBRACION
; 1.87 DA UN REDOX DE 640
; 2.10 DA UN REDOX DE 740
; SEÑAL MINIMA 0.75 PARA DETECTAR EL MODULO REDOX EQUIVALE A UN REDOX DE 70 Mv
; REDOX MAXIMO 925Mv CON 2,5 VOLTIOS
PRO51:
	RET

PRO5:	; PARA MEDIR EL REDOX

	LDS  			R19, minu			; CARGA LOS MINUTOS 
	CPI				R19, 00				; PARA NO ENCENDER EL PRIMER MINUTO
	BRBS			0, PRO51
; VALOR DE MEDICION TOTAL	

PRO5A:

	WDR
	CLR				R24
	; VALOR DE MEDICION TOTAL	
	LDI				R18, P_RD			; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
;	LDI				R26, 230
	LDS				R26, RAMC_RD		; NUMERO DE LECTURAS Ó CALIBRACION
;	CALL			PCF					; RUTINA MEDICION
	CALL			ADC_P
;******************************************************PARA MOSTRAR REDOX SIN SONDA****************************************************
; PONE EN PANTALLA GRAFICA EL VALOR DEL REDOX  LINEA 6




	MOV				R16, R24
subi	r24, 46
STS		redox_real,R24
call	radc5i; LINEA 4 PRESENTACION DEL REDOX




	LDI				R24, 60				; VALOR MINIMO PARA ACTIVAR CONTROL POR REDOX
	CP				R16, R24
	BRSH			PRO5A_1				; SALTA PRO5D SI EL MODULO ESTA CONECTADO SEÑAL MAYOR DE 110
	CBR			CONTROL, 0B01000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
	RET
PRO5A_1:



	LDI				R24, 218			; VALOR MAXIMO PARA ACTIVAR CONTROL POR REDOX
	CP				R24, R16
	BRSH			PRO5D				; SALTA PRO5D SI EL MODULO ESTA CONECTADO SEÑAL MAYOR DE 218 X 5 =1090
	CBR			CONTROL, 0B01000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
	RET
PRO5D: ;Grabar el valor en RAM Ó NO
	STS				$563,R1				; PANTALLA GRAFICA LINEA 6
	STS				$564,R2				; PANTALLA GRAFICA LINEA 6
	STS				$565,R3				; PANTALLA GRAFICA LINEA 6

	STS				$9BB,R1				; PRESENTA EL PANTALLA NORMAL
	STS				$9BC,R2				; PRESENTA EL PANTALLA NORMAL
	STS				$9BD,R3				; PRESENTA EL PANTALLA NORMAL
	; PRESENTACION EN PROGRAMAR
	STS				$97F,R1				; PRESENTA EN PANTALLA PROGRAMAR
	STS				$980,R2				; PRESENTA EN PANTALLA PROGRAMAR
	STS				$981,R3				; PRESENTA EN PANTALLA PROGRAMAR
	; PRESENTA EN PANTALLA CALIBRAR
	STS				$92D,R1				; PRESENTA EN PANTALLA CALIBRAR
	STS				$92E,R2				; PRESENTA EN PANTALLA CALIBRAR
	STS				$92F,R3				; PRESENTA EN PANTALLA CALIBRAR
	SUBI			R16, 46				; AJUSTA PUNTO CERO
	SBR			CONTROL, 0B01000000		; LINEA DE CONTROL REDOX PARA LA SEÑAL EN PANTALLA
	LDS				R24, RAM_RD			; LEE EL VALOR GRABADO EN RAM
	INC				R24					; INCREMENTO EN DOS UNIDADES Y 
	CP				R24, R16			; LO COMPARA CON EL VALOR ULTIMO LEIDO
	BRSH			PRO5D1				; SI NO ES MAYOR DE DOS DECIMAS NO LO ALMACENA
	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
	RJMP			PRO5D2
PRO5D1:
	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
	CP				R16,R24				; Y LO VUELVE A COMPARAR CON EL ALMACENADO
	BRSH			PRO5D2
	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
PRO5D2:
	MOV				R19, R16			; LO MUEVE A R19 PORQUE R16 SE USA EN LA RUTINA EEPROM_RW
	LDS				R18, RAMP_RD		; VALOR PROGRAMADO DE REDOX
; PRESENTA EL REDOX PRORAMADO 
	MOV				R24,R18
	CALL			RADC5I
	STS				$92D,R1
	STS				$92E,R2
	STS				$92F,R3
	LDS				R18,RAMP_RD	
PRO5E: ; EN R18 VALOR PROGRAMADO
	; APAGA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MAYOR QUE EL PROGRAMADO
	LDS				R19, RAM_RD			; R19 ES EL VALOR REAL REDOX
; RUTINA DE APOYO AL REDOX
	CALL			AYUDA_RD			; RUTINA DE APOYO AL REDOX
	INC				R18					; R18 ES EL VALOR PROGRAMADO
	CP				R19,R18				; SI EL REDOX MEDIDO ES MENOR QUE EL PROGRAMADO
	BRLO			PRO5F				; SALTA A PRO5A (OP1 > OP2 SALTA)
	CALL			APAGAR_FUENTE
	RJMP			PRO5G
PRO5F: ;ACTIVA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MENOR QUE EL PROGRAMADO
	DEC				R18
	DEC				R18
	CP				R18,R19
	BRLO			PRO5G
	CALL			ENCENDER_FUENTE
PRO5G:
	RET
