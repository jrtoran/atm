;ENVIO DE DATOS POR RADIO
; SALIDA DE DATOS POR EL PUERTO B DATO EN EL BIT 7
RADIO:

	SBI			PORTB,DATA_T
	LDI			R21, T_RADIO_INI; RETARDO  DE INICIO
	RCALL		RADIO_A			; RUTINA DE RATARDO
	CBI			PORTB,DATA_T

	LDS			R24, RAM_PH 	; 1 ENVIO
LDS R24, MINU
	RCALL		RADIO_B			; ORDEN DE ENVIO
	CBI			PORTB,DATA_T
RET
;	LDS			R24, RAM_CL		; 2 ENVIO
LDI	R24, 60
	RCALL		RADIO_B			; ORDEN DE ENVIO
	CBI			PORTB,DATA_T

;	LDS			R24, RAM_PH		; 3 ENVIO
LDI R24, 25
	RCALL		RADIO_B			; ORDEN DE ENVIO

	CBI			PORTB,DATA_T
	RET

RADIO_A: ;RUTINA DE RATARDO EN R21 EL TIEMPO UTILIZA EL TIMER 2
	COM			R21
	OUT			TCNT2, R21		; AQUI EL TIEMPO DE RETARDO
	CBR		CONTROL,0B00000010	; PONE A CERO EL BIT 1: SE PONE A 1 EN LA INTERRUPCION TIMER2OVF
	LDI			R16,03			; FACTOR DE DIVISION, ACTIVA EL RELOS 2
	OUT			TCCR2, R16		; FRECUENCIA DEL RELOJ 2
RADIO_A1:
	WDR
	SBRS		CONTROL, 1		; ES PUESTO A 1 EN LA INTERRUPCION TIMER2OVF
	RJMP		RADIO_A1		; SI NO ES CERO VA A RADIO_A
	LDI			R16,00			; FACTOR DE DIVISION, DESAACTIVA EL RELOj 2
	OUT			TCCR2, R16		; FRECUENCIA DEL RELOJ 2
	RET


; RETARDO ENVIO DE DATOS


RADIO_B: 	; ENVIO DE LOS BYT 

	LDI			R21, T_RADIO_E / 2
	RCALL		RADIO_A
RCALL ESPERA_A
	SBRC  		R24, 7			; SI EL BIT 7 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 7			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A

	SBRC  		R24, 6			; SI EL BIT 6 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 6			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 5			; SI EL BIT 5 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 5			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 4			; SI EL BIT 4 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 4			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 3			; SI EL BIT 3 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 3			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 2			; SI EL BIT 2 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 2			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 1			; SI EL BIT 1 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 1			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
RCALL ESPERA_A
	SBRC  		R24, 0			; SI EL BIT 0 ES CERO
	SBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE UN UNO
	SBRS  		R24, 0			; SI EL BIT ES UNO
	CBI			PORTB,DATA_T		; SALTA ESTA INSTRUCION, NO PONE A CERO
	LDI			R21, T_RADIO_E
	RCALL		RADIO_A			; RUTINA RETARDO
	CBI			PORTB,DATA_T
	LDI			R21, T_RADIO_INI
	RCALL		RADIO_A
	RET

ESPERA_A:
	CBI PORTD, 1
	NOP
	NOP
	NOP
	NOP
	NOP
	SBI	PORTD, 1
	RET
