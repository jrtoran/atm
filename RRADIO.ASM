; RECEPCION DE DATOS POR RADIO
; ENTRADA DE DATOS POR PUERTO D, 0


RRADIO:

	WDR
	NOP
	SBIS 		PIND, 0
	RJMP 		RRADIO
	LDI			R21, T_RADIO_INI/2
	RCALL		RRADIO_A41

; VERIFICA QUE NO ES SE헤L FALSA
	SBIS 		PIND, 0
	RJMP 		RRADIO			; SI ES FALSA NO HACE CASO Y VA AL INICIO
; SE헤L VALIDA LEE LOS DATOS ENVIADOS Y LOS GUARDA EN LA MEMORIA RAM
	RCALL		RRADIO_A2
	STS			RAM_PH, REC_DATOS
	RCALL		RRADIO_A2
	STS			RAM_CL, REC_DATOS
	RCALL		RRADIO_A2
	STS			RAM_TEMP, REC_DATOS
; TERMINADA LA RECEPCION ENVIA LOS DATOS AL PANEL
	LDS			R24, RAM_TEMP	; 	
	CALL		PANEL
	LDS			R24, RAM_CL	
	CALL		PANEL
	LDS			R24, RAM_PH	
	CALL		PANEL
	RJMP		RRADIO			; AL INICIO

RRADIO_A2:						; PARA SINCRONIZAR EL INICIO
	SBIC 		PIND, 0		; HASTA QUE NO SEA CERO SIGUE AQUI
	RJMP 		RRADIO_A2
	
RRADIO_A3:
	SER   		REC_DATOS		; TODO A UNO EL REGISTRO PARA ALMACENAR LOS DATOS		
	LDI			R21, T_RADIO_E
	RCALL		RRADIO_A41 
	LDI			R21, 1
	RCALL		RRADIO_A41
RCALL ESPERA
	SBIS  		PIND, 0				; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 127	; CON 01111111 = 127 ANULA BIT 7
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0				; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 191	; CON 10111111 = 191 ANULA BIT 6
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 223	; CON 11011111 = 223 ANULA BIT 5
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI 		REC_DATOS, 239	; CON 11101111 = 239 ANULA BIT 4
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 247	; CON 11110111 = 247 ANULA BIT 3
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 251	; CON 11111011 = 251 ANULA BIT 2
	RCALL 		RRADIO_A4
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 253	; CON 11111101 = 253 ANULA BIT 1
	RCALL 		RRADIO_A4	
RCALL ESPERA
	SBIS  		PIND, 0			; SI LA SE헤L ES 1 NO EJECUTA LA SIGUIENTE INSTRU.
	ANDI  		REC_DATOS, 254	; CON 11111110 = 254 ANULA BIT 0
	RCALL		RRADIO_A4
	RET

RRADIO_A4:
	LDI			R21, T_RADIO_E
RRADIO_A41:
	COM			R21
	OUT			TCNT2, R21		; AQUI EL TIEMPO DE RETARDO
	CBR			CONTROL,0B00000010		; PONE A CERO EL BIT 1: SE PONE A 1 EN LA INTERRUPCION TIMER2OVF
	LDI			R16,03			; FACTOR DE DIVISION, ACTIVA EL RELOS 2
	OUT			TCCR2, R16		; FRECUENCIA DEL RELOJ 2
RRADIO_A42:		; ESPERA EL TIEMPO ENTRE SEGMENTOS DEL DIGITO
	WDR
	SBRS		CONTROL, 1		; ES PUESTO A 1 EN LA INTERRUPCION TIMER2OVF
	RJMP		RRADIO_A42		; SI NO ES CERO VA A RADIO_A
	RET
ESPERA:
	cbi portb, 0
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	SBI PORTB, 0
	RET
	WDR
	SBRS		CONTROL, 1		; ES PUESTO A 1 EN LA INTERRUPCION TIMER2OVF
	LDI			R18, 0B01001101
	MOV			R24, R26
	CP			R24, R26
	ADD			R24, R26
	WDR
	SBRC		CONTROL, 1
	NOP
	SBI			PORTB, 1
	NOP
	RET
