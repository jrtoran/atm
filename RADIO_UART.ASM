; PROGRAMA PARA ENVIAR POR UART UN BIT O VARIOS
RADIO_UART_A:
;		CALL		UART_INI		; RUTINA PARA INICIALIZAR LA UART EN ENVIO
		CLR			R25
		LDI			R24, 67			; 67 ES LA LETRA C CODIGO DE VALIDACION DE LA LLAMADA
		OUT			UDR, R24		; COLOCA EN EL REGISTRO DE SALIDA EL VALOR A ENVIAR
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		LDS			R24, RAM_PH		; CARGA EL Ph
		ADD			R25, R24		; SUMA A R25 EL PRIMER VALOR A ENVIAR
		OUT			UDR, R24		; COLOCA EN EL REGISTRO DE SALIDA EL VALOR A ENVIAR
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		LDS			R24, RAM_RD		; CARGA EL REDOX
		ADD			R25, R24		; SUMA A R25 EL SEGUNDO VALOR A ENVIAR		
		OUT			UDR, R24		; COLOCA EN EL REGISTRO DE SALIDA EL VALOR A ENVIAR
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		LDS			R24, RAM_CL		; CARGA EL VALOR DEL CLORO LIBRE
		ADD			R25, R24		; SUMA A R25 EL TERCER VALOR A ENVIAR
		OUT			UDR, R24		; COLOCA EN EL REGISTRO DE SALIDA EL VALOR A ENVIAR
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		LDS			R24, RAM_TEMP	; CARGA LA TEMPERATURA
		ADD			R25, R24		; SUMA A R25 EL CUARTO VALOR A ENVIAR
		OUT			UDR, R24		; COLOCA EN EL REGISTRO DE SALIDA EL VALOR A ENVIAR
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		OUT			UDR, R25		; ENVIA EL VALOR DE LA SUMA PARA VERIFICACION
		RCALL		RADIO_UART_B	; ESPERA A COMPLETAR EL ENVIO
		RET							; FIN DE LA RUTINA DE ENVIO

RADIO_UART_B:
		SBIS		UCSRA, UDRE		; VERIFICA EL ENVIO DE LOS BITS BUFER VACIO
		RJMP		RADIO_UART_B	; EN CUYO CASO SALTA ESTA INSTRUCION
		RET

		; *************  RUTINA RECEPCION DE DATOS Y ENVIO AL PANEL  *****************

RRRADIO_UART_A:		; RECIBIR POR UART Y ENVIAR AL PANEL
		RCALL		UART_INI_REC	; INICIALIZAR EN RECEPCION
RRRADIO_UART_B:		; DIRECION DONDE SE GUARDAN EN RAM
		LDI   		YH, (LIN1)     	; direcion alta donde se pone el texto en RAM
		LDI   		YL, (LIN1)     	; direccion baja donde se pone el texto en RAM 
		LDI			R16, 6			; NUMERO DE DATOS A RECIBIR
; PRIMER DATO CONFIRMACION 6 DATO VERIFICACION LA SUMA DE LOS 4 VALORES
RRRADIO_UART_C:		; RECEPCION
		RCALL		RRRADIO_UART_D	; VERIFICAR LA RECEPCION COMPLETA DEL BIT
		IN			R0, UDR
		ST    		Y, R0			; guardamos en RAM POSICION EL CONTENIDO DE R0
		ADIW  		YL,1			; INCREMENTAMOS LA POSICION EN RAM PARA GUARDAR EL SIGUIENTE DATO      		
		DEC			R16      		; Hemos terminado..?? 
		BRNE		RRRADIO_UART_C 	; NO...seguimos cargando 
; VERIFICACION DE LOS VALORES ENVIADOS
		CLR			R25
		LDS			R24, $070
		CPI			R24, 67			; PRIMER CARACTER A RECIBIR UNA C CODIGO ASCII 67 VALIDAR LA RECEPCION
		BRNE		ERROR_REC		; TERMINA LA RUTINA DE RECEPCION POR ERROR
		LDS			R24, $071		; SEGUNDO CARACTER RECIBIDO
		ADD			R25,R24
		LDS			R24, $072		; TERCER CARACTER RECIBIDO
		ADD			R25,R24
		LDS			R24, $073		; CUARTO CARACTER RECIBIDO
		ADD			R25,R24
		LDS			R24, $074		; QUINTO CARACTER RECIBIDO
		ADD			R25,R24
;		LDS			R24, $075		; SEXTO CARACTER RECIBIDO VERIFICACION
;		CPSE		R25, R24		; COMPARA LA SUMA CON EL CARACTER DE VERIFICACION
;		RET							; SE EJECUTA SI R24 ES DISTINTO A R25, LA SUMA DE LOS 4 VALORES, NO ENVIA A PANEL
					;ENVIAR LOS DATOS AL PANEL
		LDS			R24, $071		; PRIMER DATO RECIBIDO
		CALL		PANEL_2			; RUTINA DE ENVIO AL PANEL DE DOS DIGITOS
		LDS			R24, $072
		CALL		PANEL_2			; RUTINA DE ENVIO AL PANEL DE DOS DIGITOS
		LDS			R24, $073
		CALL		PANEL_2			; RUTINA DE ENVIO AL PANEL DE DOS DIGITOS
		LDS			R24, $074
		CALL		PANEL_2			; RUTINA DE ENVIO AL PANEL DE TRES DIGITOS
		RET							; 



RRRADIO_UART_D:  ; Rutina verificacion del termino DE LA RECEPCION
		SBIS		UCSRA, RXC		; VERIFICA EL TERMINO DE LA RECEPCION
		RJMP		RRRADIO_UART_D	; EN CUYO CASO SALTA ESTA INSTRUCION
		IN			R17, UCSRA
		ANDI		R17, 0B00011100
		TST			R17
		BREQ		ERROR_REC
		STS			M_PRUEBA, R17
		RET
ERROR_REC:
		RET
