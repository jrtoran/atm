
; CONTROL DESGASTE ELECTRODO ****inicia con la polaridad mas eficaz***************
CONTROL_ELECTRODO:
	LDI				R17,00
	STS				SAL_ELECTRODO,R17
	
	LDI				R17, POLARIDAD_0	; LEER LA SAL EN POLARIDAD 0
	CALL			EEPROM_RW
	MOV				R19,R18				; SE ALMACENA EN R19
	LDI				R17, POLARIDAD_1	; LEER LA SAL EN POLARIDAD 1
	CALL			EEPROM_RW
	LDI				R30,INC_POLARIDAD	; ALMACENA EN R20 LA DIFERENCIA DE POLARIDAD
	ADD				R18,R30				; SUMA LA DIFERENCIA DE POLARIDAD
	CP				R19,R18
	BRGE			POL_1				; SI R18 + R20 MENOR QUE R19
	SUB				R18,R30
	ADD				R19,R30
	CP				R18,R19			
	BRGE			POL_2				; SI R19 + R20 MENOR QUE R18
	RJMP			POL_3
POL_1:
	STS				SAL_ELECTRODO,R19

	LDI				R17,MEJOR_POLARIDAD	; DIRECION A GRABAR
	LDI				R18,0				; VALOR A GRABAR
	CALL			EEPROM_ES			; OPCION GRABAR LA EERPOM
	RJMP			POL_3
POL_2:
	STS				SAL_ELECTRODO,R18
	LDI				R17,MEJOR_POLARIDAD	; DIRECION A GRABAR
	LDI				R18,1				; VALOR A GRABAR
	CALL			EEPROM_ES			; OPCION GRABAR LA EERPOM

POL_3: ;****************** COLOCA EL VALOR MAXIMO DE SAL EN LA TERCERA LINEA DE PRODUCION
;	RET
	LDS				R24,SAL_ELECTRODO 	; SOLO EN CASO DE SUPERCLORACION
	CALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
	STS				$4E8, R1			; PONE EN PANTALLA NORMAL
	STS				$4E9, R2
	STS				$4EA, R3
	LDI				R24,32
	STS				$4EB, R1			; PONE EN PANTALLA NORMAL
	STS				$4EC, R2
	STS				$4ED, R3
LDI R17,MEJOR_POLARIDAD
CALL EEPROM_RW
MOV R24,R18
	CALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
	STS				$4EC, R3			; PONE EN PANTALLA NORMAL
;	STS				$599, R2
;	STS				$59A, R3
	RET
